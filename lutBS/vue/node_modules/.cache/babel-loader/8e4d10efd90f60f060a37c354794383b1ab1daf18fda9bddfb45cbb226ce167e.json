{"ast":null,"code":"import VChart from 'vue-echarts';\nimport * as echarts from 'echarts/core';\nimport { LineChart } from 'echarts/charts';\nimport { TitleComponent, TooltipComponent, GridComponent, DatasetComponent, LegendComponent, DataZoomComponent } from 'echarts/components';\nimport { CanvasRenderer } from 'echarts/renderers';\necharts.use([LineChart, TitleComponent, TooltipComponent, GridComponent, DatasetComponent, LegendComponent, DataZoomComponent, CanvasRenderer]);\nfunction formatDateLabel(value) {\n  const date = new Date(value);\n  const month = date.getMonth() + 1;\n  const day = date.getDate();\n  const hours = date.getHours().toString().padStart(2, '0');\n  const minutes = date.getMinutes().toString().padStart(2, '0');\n  return `${month}-${day} ${hours}:${minutes}`;\n}\nexport default {\n  name: 'GreenhouseDetail',\n  components: {\n    VChart\n  },\n  data() {\n    return {\n      greenhouse: {},\n      temperatureChart: {},\n      humidityChart: {},\n      soilChart: {},\n      lightChart: {}\n    };\n  },\n  created() {\n    const id = this.$route.query.id;\n    this.loadGreenhouse(id);\n    this.loadEnvData(id);\n  },\n  methods: {\n    handleVideoError() {\n      this.$message.error(\"视频加载失败，请检查链接是否正确\");\n    },\n    loadGreenhouse(id) {\n      this.$request.get(`/api/greenhouse/getById?id=${id}`).then(res => {\n        this.greenhouse = res.data || {};\n        if (this.greenhouse.videoUrl && !this.greenhouse.videoUrl.startsWith('http')) {\n          this.greenhouse.videoUrl = this.$baseUrl + this.greenhouse.videoUrl;\n        }\n      });\n    },\n    loadEnvData(id) {\n      this.$request.get(`/api/environment/history/${id}`).then(res => {\n        const records = res.data || [];\n        const dates = records.map(r => r.recordDate);\n        const xAxisConfig = {\n          type: 'category',\n          data: dates,\n          axisLabel: {\n            formatter: formatDateLabel\n          }\n        };\n        const yAxisConfig = {\n          type: 'value',\n          max: 100,\n          // 设置最大值，视需要而定\n          min: 0 // 设置最小值\n        };\n\n        // 温度图表配置\n        this.temperatureChart = {\n          color: ['#ff7f50'],\n          tooltip: {\n            trigger: 'axis'\n          },\n          xAxis: xAxisConfig,\n          yAxis: yAxisConfig,\n          series: [{\n            name: '温度',\n            data: records.map(r => r.temperature),\n            type: 'line',\n            smooth: true\n          }]\n        };\n\n        // 湿度图表配置\n        this.humidityChart = {\n          color: ['#1e90ff'],\n          tooltip: {\n            trigger: 'axis'\n          },\n          xAxis: xAxisConfig,\n          yAxis: yAxisConfig,\n          series: [{\n            name: '湿度',\n            data: records.map(r => r.humidity),\n            type: 'line',\n            smooth: true\n          }]\n        };\n\n        // 土壤湿度图表配置\n        this.soilChart = {\n          color: ['#3cb371'],\n          tooltip: {\n            trigger: 'axis'\n          },\n          xAxis: xAxisConfig,\n          yAxis: yAxisConfig,\n          series: [{\n            name: '土壤湿度',\n            data: records.map(r => r.soilMoisture),\n            type: 'line',\n            smooth: true\n          }]\n        };\n\n        // 光照强度图表配置\n        this.lightChart = {\n          color: ['#ffa500'],\n          tooltip: {\n            trigger: 'axis'\n          },\n          xAxis: xAxisConfig,\n          yAxis: yAxisConfig,\n          series: [{\n            name: '光照强度',\n            data: records.map(r => r.lightIntensity),\n            type: 'line',\n            smooth: true\n          }]\n        };\n      });\n    }\n  }\n};","map":{"version":3,"names":["VChart","echarts","LineChart","TitleComponent","TooltipComponent","GridComponent","DatasetComponent","LegendComponent","DataZoomComponent","CanvasRenderer","use","formatDateLabel","value","date","Date","month","getMonth","day","getDate","hours","getHours","toString","padStart","minutes","getMinutes","name","components","data","greenhouse","temperatureChart","humidityChart","soilChart","lightChart","created","id","$route","query","loadGreenhouse","loadEnvData","methods","handleVideoError","$message","error","$request","get","then","res","videoUrl","startsWith","$baseUrl","records","dates","map","r","recordDate","xAxisConfig","type","axisLabel","formatter","yAxisConfig","max","min","color","tooltip","trigger","xAxis","yAxis","series","temperature","smooth","humidity","soilMoisture","lightIntensity"],"sources":["src/views/manager/GreenhouseDetail.vue"],"sourcesContent":["<template>\r\n  <div className=\"detail-page\">\r\n    <!-- 视频监控 -->\r\n    <div className=\"video-container\" v-if=\"greenhouse.videoUrl\">\r\n      <video\r\n          :src=\"greenhouse.videoUrl\"\r\n          controls\r\n          class=\"video-player\"\r\n          @error=\"handleVideoError\"\r\n      />\r\n    </div>\r\n\r\n    <!-- 图表区 -->\r\n    <div className=\"charts\">\r\n      <!-- 第一行：温度 + 湿度 -->\r\n      <div className=\"chart-row\">\r\n        <div className=\"chart-card\">\r\n          <h3>温度变化（℃）</h3>\r\n          <v-chart :option=\"temperatureChart\" class=\"chart\"/>\r\n        </div>\r\n        <div className=\"chart-card\">\r\n          <h3>湿度变化（%）</h3>\r\n          <v-chart :option=\"humidityChart\" class=\"chart\"/>\r\n        </div>\r\n      </div>\r\n\r\n      <!-- 第二行：土壤湿度 + 光照强度 -->\r\n      <div className=\"chart-row\">\r\n        <div className=\"chart-card\">\r\n          <h3>土壤湿度（%）</h3>\r\n          <v-chart :option=\"soilChart\" class=\"chart\"/>\r\n        </div>\r\n        <div className=\"chart-card\">\r\n          <h3>光照强度（lx）</h3>\r\n          <v-chart :option=\"lightChart\" class=\"chart\"/>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport VChart from 'vue-echarts'\r\nimport * as echarts from 'echarts/core'\r\nimport {LineChart} from 'echarts/charts'\r\nimport {\r\n  TitleComponent,\r\n  TooltipComponent,\r\n  GridComponent,\r\n  DatasetComponent,\r\n  LegendComponent,\r\n  DataZoomComponent\r\n} from 'echarts/components'\r\nimport {CanvasRenderer} from 'echarts/renderers'\r\n\r\necharts.use([\r\n  LineChart,\r\n  TitleComponent,\r\n  TooltipComponent,\r\n  GridComponent,\r\n  DatasetComponent,\r\n  LegendComponent,\r\n  DataZoomComponent,\r\n  CanvasRenderer\r\n])\r\n\r\nfunction formatDateLabel(value) {\r\n  const date = new Date(value)\r\n  const month = date.getMonth() + 1\r\n  const day = date.getDate()\r\n  const hours = date.getHours().toString().padStart(2, '0')\r\n  const minutes = date.getMinutes().toString().padStart(2, '0')\r\n  return `${month}-${day} ${hours}:${minutes}`\r\n}\r\n\r\nexport default {\r\n  name: 'GreenhouseDetail',\r\n  components: {VChart},\r\n  data() {\r\n    return {\r\n      greenhouse: {},\r\n      temperatureChart: {},\r\n      humidityChart: {},\r\n      soilChart: {},\r\n      lightChart: {}\r\n    }\r\n  },\r\n  created() {\r\n    const id = this.$route.query.id\r\n    this.loadGreenhouse(id)\r\n    this.loadEnvData(id)\r\n  },\r\n  methods: {\r\n    handleVideoError() {\r\n      this.$message.error(\"视频加载失败，请检查链接是否正确\")\r\n    },\r\n    loadGreenhouse(id) {\r\n      this.$request.get(`/api/greenhouse/getById?id=${id}`).then(res => {\r\n        this.greenhouse = res.data || {}\r\n        if (this.greenhouse.videoUrl && !this.greenhouse.videoUrl.startsWith('http')) {\r\n          this.greenhouse.videoUrl = this.$baseUrl + this.greenhouse.videoUrl\r\n        }\r\n      })\r\n    },\r\n    loadEnvData(id) {\r\n      this.$request.get(`/api/environment/history/${id}`).then(res => {\r\n        const records = res.data || []\r\n        const dates = records.map(r => r.recordDate)\r\n\r\n        const xAxisConfig = {\r\n          type: 'category',\r\n          data: dates,\r\n          axisLabel: {\r\n            formatter: formatDateLabel\r\n          }\r\n        }\r\n\r\n        const yAxisConfig = {\r\n          type: 'value',\r\n          max: 100,  // 设置最大值，视需要而定\r\n          min: 0     // 设置最小值\r\n        }\r\n\r\n        // 温度图表配置\r\n        this.temperatureChart = {\r\n          color: ['#ff7f50'],\r\n          tooltip: {trigger: 'axis'},\r\n          xAxis: xAxisConfig,\r\n          yAxis: yAxisConfig,\r\n          series: [{\r\n            name: '温度',\r\n            data: records.map(r => r.temperature),\r\n            type: 'line',\r\n            smooth: true\r\n          }]\r\n        }\r\n\r\n        // 湿度图表配置\r\n        this.humidityChart = {\r\n          color: ['#1e90ff'],\r\n          tooltip: {trigger: 'axis'},\r\n          xAxis: xAxisConfig,\r\n          yAxis: yAxisConfig,\r\n          series: [{\r\n            name: '湿度',\r\n            data: records.map(r => r.humidity),\r\n            type: 'line',\r\n            smooth: true\r\n          }]\r\n        }\r\n\r\n        // 土壤湿度图表配置\r\n        this.soilChart = {\r\n          color: ['#3cb371'],\r\n          tooltip: {trigger: 'axis'},\r\n          xAxis: xAxisConfig,\r\n          yAxis: yAxisConfig,\r\n          series: [{\r\n            name: '土壤湿度',\r\n            data: records.map(r => r.soilMoisture),\r\n            type: 'line',\r\n            smooth: true\r\n          }]\r\n        }\r\n\r\n        // 光照强度图表配置\r\n        this.lightChart = {\r\n          color: ['#ffa500'],\r\n          tooltip: {trigger: 'axis'},\r\n          xAxis: xAxisConfig,\r\n          yAxis: yAxisConfig,\r\n          series: [{\r\n            name: '光照强度',\r\n            data: records.map(r => r.lightIntensity),\r\n            type: 'line',\r\n            smooth: true\r\n          }]\r\n        }\r\n      })\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n.detail-page {\r\n  padding: 20px;\r\n}\r\n\r\n.video-container {\r\n  width: 100%;\r\n  height: 400px;\r\n  margin-bottom: 30px;\r\n}\r\n\r\n.video-player {\r\n  width: 100%;\r\n  height: 100%;\r\n  border-radius: 8px;\r\n}\r\n\r\n.charts {\r\n  display: flex;\r\n  flex-direction: column;\r\n  gap: 30px;\r\n}\r\n\r\n.chart-row {\r\n  display: flex;\r\n  flex-wrap: wrap;\r\n  justify-content: space-between;\r\n  gap: 30px;\r\n}\r\n\r\n.chart-card {\r\n  flex: 1;\r\n  min-width: 48%;\r\n  background: #fff;\r\n  padding: 20px;\r\n  border-radius: 10px;\r\n  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);\r\n}\r\n\r\n.chart {\r\n  width: 100%;\r\n  height: 300px;\r\n}\r\n</style>\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}