{"ast":null,"code":"import VChart from 'vue-echarts';\nimport * as echarts from 'echarts/core';\nimport { LineChart } from 'echarts/charts';\nimport { GridComponent, TooltipComponent, DatasetComponent } from 'echarts/components';\nimport { CanvasRenderer } from 'echarts/renderers';\necharts.use([LineChart, GridComponent, TooltipComponent, DatasetComponent, CanvasRenderer]);\nexport default {\n  name: 'Home',\n  components: {\n    VChart\n  },\n  data() {\n    return {\n      user: JSON.parse(localStorage.getItem('xm-user') || '{}'),\n      /* 汇总数据 */\n      kpi: {\n        greenhouseTotal: 0,\n        taskTodo: 0,\n        envAlarm: 0\n      },\n      /* 列表缓存 */\n      greenhouses: [],\n      tasks: [],\n      /* mini chart */\n      miniChart: {},\n      /* 公告 / 天气 */\n      notices: [],\n      weather: null\n    };\n  },\n  computed: {\n    todoTasks() {\n      return this.tasks.filter(t => t.completed !== '是').slice(0, 5);\n    }\n  },\n  created() {\n    this.loadGreenhouses();\n    this.loadTasks();\n    this.loadMiniChart();\n    this.loadNotices();\n    this.loadWeather();\n  },\n  methods: {\n    /* ---------------- 基础数据 ---------------- */\n    loadGreenhouses() {\n      this.$request.get('/api/greenhouse/getAll').then(r => {\n        this.greenhouses = r.data || [];\n        this.kpi.greenhouseTotal = this.greenhouses.length;\n        // 统计报警：温>35 或 湿<30\n        this.kpi.envAlarm = this.greenhouses.filter(g => g.temperature > 35 || g.humidity < 30).length;\n      });\n    },\n    loadTasks() {\n      this.$request.get('/api/task/getAll').then(r => {\n        this.tasks = r.data || [];\n        this.kpi.taskTodo = this.tasks.filter(t => t.completed !== '是').length;\n      });\n    },\n    /* ---------------- mini 折线图 ---------------- */\n    loadMiniChart() {\n      // 这里只示例取 greenhouseId=1，实际可以让用户下拉选择\n      this.$request.get('/api/environment/history/1').then(r => {\n        const rows = (r.data || []).slice(-48); // 最近 48 条（24h，5min/条）\n        const temp = rows.map(i => i.temperature);\n        const hum = rows.map(i => i.humidity);\n        this.miniChart = {\n          grid: {\n            left: 0,\n            right: 0,\n            top: 10,\n            bottom: 20\n          },\n          tooltip: {\n            trigger: 'axis'\n          },\n          xAxis: {\n            type: 'category',\n            data: rows.map(i => i.recordDate),\n            show: false\n          },\n          yAxis: {\n            type: 'value',\n            show: false\n          },\n          series: [{\n            data: temp,\n            type: 'line',\n            smooth: true,\n            name: '温度',\n            lineStyle: {\n              color: '#ff7f50'\n            }\n          }, {\n            data: hum,\n            type: 'line',\n            smooth: true,\n            name: '湿度',\n            lineStyle: {\n              color: '#1e90ff'\n            }\n          }]\n        };\n      });\n    },\n    /* ---------------- 公告 / 天气 ---------------- */\n    loadNotices() {\n      this.$request.get('/api/notice/list').then(r => {\n        this.notices = r.data || [];\n      });\n    },\n    loadWeather() {\n      // 演示用假数据，替换为真实 API 即可\n      this.weather = {\n        temp: 23,\n        text: '多云',\n        wind: '南风 3级'\n      };\n    },\n    /* ---------------- 快捷操作 ---------------- */\n    quickToggle(type, targetStatus) {\n      this.$confirm(`确认将所有大棚“${type === 'irrigation' ? '灌溉' : '灯光'}”统一${targetStatus ? '开启' : '关闭'}？`, '提示', {\n        type: 'warning'\n      }).then(() => {\n        const reqs = this.greenhouses.map(g => this.$request.post(`/api/greenhouse/${g.greenhouseId}/toggle/${type}`, {\n          status: targetStatus\n        }));\n        return Promise.all(reqs);\n      }).then(() => {\n        this.$message.success('操作已执行');\n        this.loadGreenhouses();\n      });\n    },\n    /* ---------------- 任务完成 ---------------- */\n    finishTask(row) {\n      row.completed = '是';\n      this.$request.post('/api/task/save', row).then(() => {\n        this.$message.success('已标记完成');\n        this.loadTasks();\n      });\n    }\n  }\n};","map":{"version":3,"names":["VChart","echarts","LineChart","GridComponent","TooltipComponent","DatasetComponent","CanvasRenderer","use","name","components","data","user","JSON","parse","localStorage","getItem","kpi","greenhouseTotal","taskTodo","envAlarm","greenhouses","tasks","miniChart","notices","weather","computed","todoTasks","filter","t","completed","slice","created","loadGreenhouses","loadTasks","loadMiniChart","loadNotices","loadWeather","methods","$request","get","then","r","length","g","temperature","humidity","rows","temp","map","i","hum","grid","left","right","top","bottom","tooltip","trigger","xAxis","type","recordDate","show","yAxis","series","smooth","lineStyle","color","text","wind","quickToggle","targetStatus","$confirm","reqs","post","greenhouseId","status","Promise","all","$message","success","finishTask","row"],"sources":["src/views/manager/Home.vue"],"sourcesContent":["<template>\n  <div class=\"home-container\">\n\n    <!-- ① 欢迎 -->\n    <el-card class=\"greet-card\">\n      您好，{{ user?.userName }}！欢迎使用本系统\n    </el-card>\n\n    <!-- ② 关键指标 -->\n    <div class=\"kpi-wrap\">\n      <el-card class=\"kpi\" body-style=\"padding:16px\">\n        <div class=\"kpi-num\">{{ kpi.greenhouseTotal }}</div>\n        <div class=\"kpi-label\">在线大棚</div>\n      </el-card>\n\n      <el-card class=\"kpi\" body-style=\"padding:16px\">\n        <div class=\"kpi-num\">{{ kpi.taskTodo }}</div>\n        <div class=\"kpi-label\">待办任务</div>\n      </el-card>\n\n      <el-card class=\"kpi\" body-style=\"padding:16px\">\n        <div class=\"kpi-num\">{{ kpi.envAlarm }}</div>\n        <div class=\"kpi-label\">环境报警</div>\n      </el-card>\n    </div>\n\n    <!-- ③ 大棚状态表（前 5 条） -->\n    <el-card shadow=\"always\" class=\"mt20\">\n      <div slot=\"header\" class=\"card-title\">大棚状态</div>\n      <el-table :data=\"greenhouses.slice(0,5)\" border size=\"mini\">\n        <el-table-column prop=\"greenhouseName\" label=\"名称\" />\n        <el-table-column prop=\"irrigationStatus\" label=\"灌溉\" width=\"80\">\n          <template slot-scope=\"s\">\n            <el-tag :type=\"s.row.irrigationStatus?'success':'info'\" size=\"mini\">\n              {{ s.row.irrigationStatus ? '✔' : '✘' }}\n            </el-tag>\n          </template>\n        </el-table-column>\n        <el-table-column prop=\"ventilationStatus\" label=\"通风\" width=\"80\">\n          <template slot-scope=\"s\">\n            <el-tag :type=\"s.row.ventilationStatus?'success':'info'\" size=\"mini\">\n              {{ s.row.ventilationStatus ? '✔' : '✘' }}\n            </el-tag>\n          </template>\n        </el-table-column>\n        <el-table-column prop=\"lightingStatus\" label=\"灯光\" width=\"80\">\n          <template slot-scope=\"s\">\n            <el-tag :type=\"s.row.lightingStatus?'warning':'info'\" size=\"mini\">\n              {{ s.row.lightingStatus ? '✔' : '✘' }}\n            </el-tag>\n          </template>\n        </el-table-column>\n        <el-table-column label=\"操作\" width=\"100\">\n          <template slot-scope=\"s\">\n            <el-button type=\"text\" size=\"mini\"\n                       @click=\"$router.push({name:'GreenhouseDetail',query:{id:s.row.greenhouseId}})\">详情</el-button>\n          </template>\n        </el-table-column>\n      </el-table>\n    </el-card>\n\n    <!-- ④ 小折线图 + 天气 -->\n    <div class=\"mini-section\">\n      <el-card class=\"mini-chart-card\" shadow=\"always\">\n        <div slot=\"header\" class=\"card-title\">温/湿最近24h</div>\n        <v-chart :option=\"miniChart\" style=\"height:120px\"/>\n      </el-card>\n\n      <el-card class=\"weather-card\" shadow=\"always\">\n        <div slot=\"header\" class=\"card-title\">今日天气</div>\n        <div v-if=\"weather\">\n          <div style=\"font-size:28px\">{{ weather.temp }}°C</div>\n          <div>{{ weather.text }} / {{ weather.wind }}</div>\n        </div>\n        <div v-else>加载中...</div>\n      </el-card>\n    </div>\n\n    <!-- ⑤ 待办任务列表（未完成） -->\n    <el-card shadow=\"always\" class=\"mt20\">\n      <div slot=\"header\" class=\"card-title\">待办任务</div>\n      <el-table :data=\"todoTasks\" stripe size=\"mini\" height=\"220\">\n        <el-table-column prop=\"name\" label=\"任务\" />\n        <el-table-column prop=\"taskGreenhouseName\" label=\"大棚\" width=\"120\"/>\n        <el-table-column prop=\"deadline\" label=\"截止\" width=\"160\"/>\n        <el-table-column width=\"80\">\n          <template slot=\"header\">操作</template>\n          <template slot-scope=\"s\">\n            <el-button type=\"text\" size=\"mini\" @click=\"finishTask(s.row)\">完成</el-button>\n          </template>\n        </el-table-column>\n      </el-table>\n    </el-card>\n\n    <!-- ⑥ 公告 & 快捷 -->\n    <div class=\"mt20 flex-row\">\n      <el-card class=\"notice-card\" shadow=\"always\" style=\"flex:2;margin-right:20px\">\n        <div slot=\"header\" class=\"card-title\">公告</div>\n        <el-timeline>\n          <el-timeline-item v-for=\"n in notices\" :key=\"n.id\" :timestamp=\"n.createTime\" size=\"small\">\n            {{ n.title }}\n          </el-timeline-item>\n        </el-timeline>\n      </el-card>\n\n      <el-card class=\"quick-card\" shadow=\"always\" style=\"flex:1\">\n        <div slot=\"header\" class=\"card-title\">快捷操作</div>\n        <el-button type=\"primary\" plain @click=\"quickToggle('irrigation',1)\">全部开启灌溉</el-button>\n        <el-button type=\"warning\" plain class=\"mt10\" @click=\"quickToggle('lighting',0)\">全部关闭灯光</el-button>\n      </el-card>\n    </div>\n\n  </div>\n</template>\n\n<script>\nimport VChart from 'vue-echarts'\nimport * as echarts from 'echarts/core'\nimport {LineChart} from 'echarts/charts'\nimport {GridComponent, TooltipComponent, DatasetComponent} from 'echarts/components'\nimport {CanvasRenderer} from 'echarts/renderers'\necharts.use([LineChart, GridComponent, TooltipComponent, DatasetComponent, CanvasRenderer])\n\nexport default {\n  name: 'Home',\n  components: {VChart},\n  data () {\n    return {\n      user: JSON.parse(localStorage.getItem('xm-user') || '{}'),\n\n      /* 汇总数据 */\n      kpi: { greenhouseTotal: 0, taskTodo: 0, envAlarm: 0 },\n\n      /* 列表缓存 */\n      greenhouses: [],\n      tasks: [],\n\n      /* mini chart */\n      miniChart: {},\n\n      /* 公告 / 天气 */\n      notices: [],\n      weather: null\n    }\n  },\n  computed: {\n    todoTasks () {\n      return this.tasks.filter(t => t.completed !== '是').slice(0, 5)\n    }\n  },\n  created () {\n    this.loadGreenhouses()\n    this.loadTasks()\n    this.loadMiniChart()\n    this.loadNotices()\n    this.loadWeather()\n  },\n  methods: {\n    /* ---------------- 基础数据 ---------------- */\n    loadGreenhouses () {\n      this.$request.get('/api/greenhouse/getAll').then(r => {\n        this.greenhouses            = r.data || []\n        this.kpi.greenhouseTotal    = this.greenhouses.length\n        // 统计报警：温>35 或 湿<30\n        this.kpi.envAlarm = this.greenhouses.filter(g => g.temperature>35 || g.humidity<30).length\n      })\n    },\n    loadTasks () {\n      this.$request.get('/api/task/getAll').then(r => {\n        this.tasks         = r.data || []\n        this.kpi.taskTodo  = this.tasks.filter(t => t.completed !== '是').length\n      })\n    },\n\n    /* ---------------- mini 折线图 ---------------- */\n    loadMiniChart () {\n      // 这里只示例取 greenhouseId=1，实际可以让用户下拉选择\n      this.$request.get('/api/environment/history/1').then(r => {\n        const rows = (r.data||[]).slice(-48)          // 最近 48 条（24h，5min/条）\n        const temp = rows.map(i=>i.temperature)\n        const hum  = rows.map(i=>i.humidity)\n        this.miniChart = {\n          grid:{left:0,right:0,top:10,bottom:20},\n          tooltip:{trigger:'axis'},\n          xAxis:{type:'category',data:rows.map(i=>i.recordDate),show:false},\n          yAxis:{type:'value',show:false},\n          series:[\n            {data:temp,type:'line',smooth:true,name:'温度',lineStyle:{color:'#ff7f50'}},\n            {data:hum, type:'line',smooth:true,name:'湿度',lineStyle:{color:'#1e90ff'}}\n          ]\n        }\n      })\n    },\n\n    /* ---------------- 公告 / 天气 ---------------- */\n    loadNotices () {\n      this.$request.get('/api/notice/list').then(r => { this.notices = r.data||[] })\n    },\n    loadWeather () {          // 演示用假数据，替换为真实 API 即可\n      this.weather = { temp: 23, text:'多云', wind:'南风 3级' }\n    },\n\n    /* ---------------- 快捷操作 ---------------- */\n    quickToggle (type, targetStatus) {\n      this.$confirm(`确认将所有大棚“${type==='irrigation'?'灌溉':'灯光'}”统一${targetStatus? '开启':'关闭'}？`,\n          '提示', {type:'warning'})\n          .then(()=> {\n            const reqs = this.greenhouses.map(g =>\n                this.$request.post(`/api/greenhouse/${g.greenhouseId}/toggle/${type}`,{status:targetStatus}))\n            return Promise.all(reqs)\n          })\n          .then(()=>{ this.$message.success('操作已执行'); this.loadGreenhouses() })\n    },\n\n    /* ---------------- 任务完成 ---------------- */\n    finishTask (row) {\n      row.completed = '是'\n      this.$request.post('/api/task/save', row).then(()=>{\n        this.$message.success('已标记完成')\n        this.loadTasks()\n      })\n    }\n  }\n}\n</script>\n\n<style scoped>\n.home-container { padding:20px }\n.mt20            { margin-top:20px }\n.flex-row        { display:flex }\n.greet-card      { font-weight:600;font-size:20px }\n.card-title      { font-weight:600 }\n\n.kpi-wrap { display:flex; gap:20px; margin:20px 0 }\n.kpi      { flex:1; text-align:center }\n.kpi-num  { font-size:32px; font-weight:700 }\n.kpi-label{ color:#888 }\n\n.mini-section      { display:flex; gap:20px; margin-top:20px }\n.mini-chart-card   { flex:2 }\n.weather-card      { flex:1; display:flex; justify-content:center; align-items:center }\n</style>\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}