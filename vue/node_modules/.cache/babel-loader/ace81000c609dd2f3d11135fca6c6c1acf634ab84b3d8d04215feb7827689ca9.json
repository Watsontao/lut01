{"ast":null,"code":"export default {\n  name: 'TaskList',\n  data() {\n    return {\n      tasks: [],\n      showDetail: false,\n      searchKey: '',\n      multipleSelection: [],\n      /* 弹窗 & 表单 */\n      dialogVisible: false,\n      form: {},\n      rules: {\n        name: [{\n          required: true,\n          message: '请输入任务名称',\n          trigger: 'blur'\n        }],\n        taskContent: [{\n          required: true,\n          message: '请输入任务内容',\n          trigger: 'blur'\n        }],\n        taskGreenhouseName: [{\n          required: true,\n          message: '请输入所属大棚',\n          trigger: 'blur'\n        }],\n        assignedUserId: [{\n          required: true,\n          message: '请输入用户 ID',\n          trigger: 'blur'\n        }]\n      }\n    };\n  },\n  computed: {\n    /* 简易前端搜索过滤 */\n    filteredTasks() {\n      const key = this.searchKey.trim();\n      if (!key) return this.tasks;\n      return this.tasks.filter(t => t.name?.includes(key) || t.taskGreenhouseName?.includes(key) || String(t.assignedUserId).includes(key));\n    }\n  },\n  created() {\n    this.loadTasks();\n  },\n  methods: {\n    /* ---------------- API ---------------- */\n    loadTasks() {\n      this.$request.get('/api/task/getAll').then(res => {\n        this.tasks = res.data || [];\n      });\n    },\n    saveTask() {\n      this.$request.post('/api/task/save', this.form).then(() => {\n        this.$message.success('保存成功');\n        this.dialogVisible = false;\n        this.loadTasks();\n      });\n    },\n    handleDelete(id) {\n      this.$confirm('确认删除该任务？', '提示', {\n        type: 'warning'\n      }).then(() => this.$request.delete(`/api/task/delete/${id}`)).then(() => {\n        this.$message.success('删除成功');\n        this.loadTasks();\n      });\n    },\n    handleBatchDelete() {\n      const ids = this.multipleSelection.map(i => i.taskId);\n      this.$confirm(`确认批量删除 ${ids.length} 条记录？`, '提示', {\n        type: 'warning'\n      }).then(() => this.$request.post('/api/task/deleteBatch', ids)).then(() => {\n        this.$message.success('批量删除成功');\n        this.loadTasks();\n      });\n    },\n    /* ---------------- UI ---------------- */\n    toggleView() {\n      this.showDetail = !this.showDetail;\n    },\n    openEdit(row = {}) {\n      this.form = {\n        ...row\n      }; // 深拷贝简单对象\n      this.dialogVisible = true;\n    },\n    submitForm() {\n      this.$refs.formRef.validate(valid => valid && this.saveTask());\n    },\n    resetForm() {\n      this.$refs.formRef && this.$refs.formRef.resetFields();\n      this.form = {};\n    }\n  }\n};","map":{"version":3,"names":["name","data","tasks","showDetail","searchKey","multipleSelection","dialogVisible","form","rules","required","message","trigger","taskContent","taskGreenhouseName","assignedUserId","computed","filteredTasks","key","trim","filter","t","includes","String","created","loadTasks","methods","$request","get","then","res","saveTask","post","$message","success","handleDelete","id","$confirm","type","delete","handleBatchDelete","ids","map","i","taskId","length","toggleView","openEdit","row","submitForm","$refs","formRef","validate","valid","resetForm","resetFields"],"sources":["src/views/manager/TaskList.vue"],"sourcesContent":["<template>\n  <div class=\"task-page\">\n    <!-- 顶部工具栏 -->\n    <div class=\"toolbar\">\n      <div>\n        <el-button type=\"primary\" plain @click=\"toggleView\">\n          {{ showDetail ? '简略信息' : '详细信息' }}\n        </el-button>\n        <el-button type=\"success\" @click=\"openEdit()\">新增任务</el-button>\n        <el-button\n            type=\"danger\"\n            :disabled=\"!multipleSelection.length\"\n            @click=\"handleBatchDelete\"\n        >批量删除</el-button>\n      </div>\n\n      <!-- 搜索框 -->\n      <el-input\n          v-model=\"searchKey\"\n          placeholder=\"搜索任务 / 大棚 / 用户\"\n          size=\"small\"\n          style=\"max-width: 260px\"\n          clearable\n          @keyup.enter.native=\"loadTasks\"\n      >\n        <template #append>\n          <el-button icon=\"el-icon-search\" @click=\"loadTasks\" />\n        </template>\n      </el-input>\n    </div>\n\n    <!-- 任务表格 -->\n    <el-table\n        :data=\"filteredTasks\"\n        border\n        stripe\n        style=\"width: 100%;\"\n        @selection-change=\"multipleSelection = $event\"\n    >\n      <el-table-column type=\"selection\" width=\"45\" />\n\n      <el-table-column\n          v-if=\"showDetail || true\"\n          prop=\"taskId\"\n          label=\"ID\"\n          width=\"70\"\n          align=\"center\"\n      />\n\n      <el-table-column prop=\"name\" label=\"任务名称\" min-width=\"130\" />\n\n      <el-table-column\n          v-if=\"showDetail\"\n          prop=\"taskContent\"\n          label=\"任务内容\"\n          min-width=\"160\"\n          show-overflow-tooltip\n      />\n\n      <el-table-column\n          prop=\"taskGreenhouseName\"\n          label=\"所属大棚\"\n          min-width=\"100\"\n      />\n\n      <el-table-column\n          prop=\"assignedUserId\"\n          label=\"指派用户\"\n          min-width=\"90\"\n      />\n\n      <el-table-column\n          label=\"完成状态\"\n          width=\"90\"\n          align=\"center\"\n      >\n        <template #default=\"scope\">\n          <el-tag\n              :type=\"scope.row.completed === '是' ? 'success' : 'info'\"\n              size=\"mini\"\n          >\n            {{ scope.row.completed === '是' ? '已完成' : '未完成' }}\n          </el-tag>\n        </template>\n      </el-table-column>\n\n      <el-table-column\n          v-if=\"showDetail\"\n          prop=\"publishTime\"\n          label=\"发布时间\"\n          min-width=\"120\"\n      />\n      <el-table-column\n          v-if=\"showDetail\"\n          prop=\"deadline\"\n          label=\"截止时间\"\n          min-width=\"120\"\n      />\n\n      <el-table-column\n          v-if=\"showDetail\"\n          prop=\"taskDescription\"\n          label=\"备注\"\n          min-width=\"140\"\n          show-overflow-tooltip\n      />\n\n      <!-- 操作列 -->\n      <el-table-column label=\"操作\" width=\"180\" fixed=\"right\">\n        <template #default=\"scope\">\n          <el-button\n              size=\"mini\"\n              @click=\"openEdit(scope.row)\"\n              type=\"primary\"\n          >编辑</el-button>\n          <el-button\n              size=\"mini\"\n              type=\"danger\"\n              @click=\"handleDelete(scope.row.taskId)\"\n          >删除</el-button>\n        </template>\n      </el-table-column>\n    </el-table>\n\n    <!-- 编辑/新增 弹窗 -->\n    <el-dialog\n        :title=\"form.taskId ? '编辑任务' : '新增任务'\"\n        :visible.sync=\"dialogVisible\"\n        width=\"540px\"\n        @close=\"resetForm\"\n    >\n      <el-form :model=\"form\" :rules=\"rules\" ref=\"formRef\" label-width=\"95px\">\n        <el-form-item label=\"任务名称\" prop=\"name\">\n          <el-input v-model=\"form.name\" />\n        </el-form-item>\n\n        <el-form-item label=\"任务内容\" prop=\"taskContent\">\n          <el-input\n              type=\"textarea\"\n              :rows=\"3\"\n              v-model=\"form.taskContent\"\n              maxlength=\"200\"\n              show-word-limit\n          />\n        </el-form-item>\n\n        <el-form-item label=\"所属大棚\" prop=\"taskGreenhouseName\">\n          <el-input v-model=\"form.taskGreenhouseName\" />\n        </el-form-item>\n\n        <el-form-item label=\"指派用户\" prop=\"assignedUserId\">\n          <el-input-number v-model=\"form.assignedUserId\" :min=\"1\" />\n        </el-form-item>\n\n        <el-form-item label=\"截止时间\" prop=\"deadline\">\n          <el-date-picker\n              v-model=\"form.deadline\"\n              type=\"datetime\"\n              placeholder=\"选择截止时间\"\n              style=\"width: 100%\"\n          />\n        </el-form-item>\n\n        <el-form-item label=\"备注\">\n          <el-input\n              type=\"textarea\"\n              v-model=\"form.taskDescription\"\n              :rows=\"2\"\n              maxlength=\"120\"\n              show-word-limit\n          />\n        </el-form-item>\n      </el-form>\n\n      <template #footer>\n        <el-button @click=\"dialogVisible = false\">取消</el-button>\n        <el-button type=\"primary\" @click=\"submitForm\">保存</el-button>\n      </template>\n    </el-dialog>\n  </div>\n</template>\n\n<script>\nexport default {\n  name: 'TaskList',\n  data () {\n    return {\n      tasks: [],\n      showDetail: false,\n      searchKey: '',\n      multipleSelection: [],\n\n      /* 弹窗 & 表单 */\n      dialogVisible: false,\n      form: {},\n      rules: {\n        name: [{ required: true, message: '请输入任务名称', trigger: 'blur' }],\n        taskContent: [{ required: true, message: '请输入任务内容', trigger: 'blur' }],\n        taskGreenhouseName: [{ required: true, message: '请输入所属大棚', trigger: 'blur' }],\n        assignedUserId: [{ required: true, message: '请输入用户 ID', trigger: 'blur' }]\n      }\n    }\n  },\n  computed: {\n    /* 简易前端搜索过滤 */\n    filteredTasks () {\n      const key = this.searchKey.trim()\n      if (!key) return this.tasks\n      return this.tasks.filter(t =>\n          t.name?.includes(key) ||\n          t.taskGreenhouseName?.includes(key) ||\n          String(t.assignedUserId).includes(key)\n      )\n    }\n  },\n  created () {\n    this.loadTasks()\n  },\n  methods: {\n    /* ---------------- API ---------------- */\n    loadTasks () {\n      this.$request.get('/api/task/getAll').then(res => {\n        this.tasks = res.data || []\n      })\n    },\n    saveTask () {\n      this.$request.post('/api/task/save', this.form).then(() => {\n        this.$message.success('保存成功')\n        this.dialogVisible = false\n        this.loadTasks()\n      })\n    },\n    handleDelete (id) {\n      this.$confirm('确认删除该任务？', '提示', { type: 'warning' })\n          .then(() => this.$request.delete(`/api/task/delete/${id}`))\n          .then(() => {\n            this.$message.success('删除成功')\n            this.loadTasks()\n          })\n    },\n    handleBatchDelete () {\n      const ids = this.multipleSelection.map(i => i.taskId)\n      this.$confirm(`确认批量删除 ${ids.length} 条记录？`, '提示', { type: 'warning' })\n          .then(() => this.$request.post('/api/task/deleteBatch', ids))\n          .then(() => {\n            this.$message.success('批量删除成功')\n            this.loadTasks()\n          })\n    },\n    /* ---------------- UI ---------------- */\n    toggleView () {\n      this.showDetail = !this.showDetail\n    },\n    openEdit (row = {}) {\n      this.form = { ...row }   // 深拷贝简单对象\n      this.dialogVisible = true\n    },\n    submitForm () {\n      this.$refs.formRef.validate(valid => valid && this.saveTask())\n    },\n    resetForm () {\n      this.$refs.formRef && this.$refs.formRef.resetFields()\n      this.form = {}\n    }\n  }\n}\n</script>\n\n<style scoped>\n.task-page   { padding: 15px }\n.toolbar     { display: flex; justify-content: space-between; margin-bottom: 12px }\n</style>\n"],"mappings":"AAuLA;EACAA,IAAA;EACAC,KAAA;IACA;MACAC,KAAA;MACAC,UAAA;MACAC,SAAA;MACAC,iBAAA;MAEA;MACAC,aAAA;MACAC,IAAA;MACAC,KAAA;QACAR,IAAA;UAAAS,QAAA;UAAAC,OAAA;UAAAC,OAAA;QAAA;QACAC,WAAA;UAAAH,QAAA;UAAAC,OAAA;UAAAC,OAAA;QAAA;QACAE,kBAAA;UAAAJ,QAAA;UAAAC,OAAA;UAAAC,OAAA;QAAA;QACAG,cAAA;UAAAL,QAAA;UAAAC,OAAA;UAAAC,OAAA;QAAA;MACA;IACA;EACA;EACAI,QAAA;IACA;IACAC,cAAA;MACA,MAAAC,GAAA,QAAAb,SAAA,CAAAc,IAAA;MACA,KAAAD,GAAA,cAAAf,KAAA;MACA,YAAAA,KAAA,CAAAiB,MAAA,CAAAC,CAAA,IACAA,CAAA,CAAApB,IAAA,EAAAqB,QAAA,CAAAJ,GAAA,KACAG,CAAA,CAAAP,kBAAA,EAAAQ,QAAA,CAAAJ,GAAA,KACAK,MAAA,CAAAF,CAAA,CAAAN,cAAA,EAAAO,QAAA,CAAAJ,GAAA,CACA;IACA;EACA;EACAM,QAAA;IACA,KAAAC,SAAA;EACA;EACAC,OAAA;IACA;IACAD,UAAA;MACA,KAAAE,QAAA,CAAAC,GAAA,qBAAAC,IAAA,CAAAC,GAAA;QACA,KAAA3B,KAAA,GAAA2B,GAAA,CAAA5B,IAAA;MACA;IACA;IACA6B,SAAA;MACA,KAAAJ,QAAA,CAAAK,IAAA,wBAAAxB,IAAA,EAAAqB,IAAA;QACA,KAAAI,QAAA,CAAAC,OAAA;QACA,KAAA3B,aAAA;QACA,KAAAkB,SAAA;MACA;IACA;IACAU,aAAAC,EAAA;MACA,KAAAC,QAAA;QAAAC,IAAA;MAAA,GACAT,IAAA,YAAAF,QAAA,CAAAY,MAAA,qBAAAH,EAAA,KACAP,IAAA;QACA,KAAAI,QAAA,CAAAC,OAAA;QACA,KAAAT,SAAA;MACA;IACA;IACAe,kBAAA;MACA,MAAAC,GAAA,QAAAnC,iBAAA,CAAAoC,GAAA,CAAAC,CAAA,IAAAA,CAAA,CAAAC,MAAA;MACA,KAAAP,QAAA,WAAAI,GAAA,CAAAI,MAAA;QAAAP,IAAA;MAAA,GACAT,IAAA,YAAAF,QAAA,CAAAK,IAAA,0BAAAS,GAAA,GACAZ,IAAA;QACA,KAAAI,QAAA,CAAAC,OAAA;QACA,KAAAT,SAAA;MACA;IACA;IACA;IACAqB,WAAA;MACA,KAAA1C,UAAA,SAAAA,UAAA;IACA;IACA2C,SAAAC,GAAA;MACA,KAAAxC,IAAA;QAAA,GAAAwC;MAAA;MACA,KAAAzC,aAAA;IACA;IACA0C,WAAA;MACA,KAAAC,KAAA,CAAAC,OAAA,CAAAC,QAAA,CAAAC,KAAA,IAAAA,KAAA,SAAAtB,QAAA;IACA;IACAuB,UAAA;MACA,KAAAJ,KAAA,CAAAC,OAAA,SAAAD,KAAA,CAAAC,OAAA,CAAAI,WAAA;MACA,KAAA/C,IAAA;IACA;EACA;AACA"},"metadata":{},"sourceType":"module","externalDependencies":[]}